<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>The Table ‚Ä¢ AKDmediaX</title>

    <!-- Minimal meta; no CI spelled out -->
    <meta
      name="description"
      content="The Table is a Kingdom creative space hosted by AKDmediaX."
    />
    <link rel="canonical" href="https://ci.cherev/" />

    <!-- Social preview just points at the table image -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="The Table ‚Ä¢ AKDmediaX" />
    <meta
      property="og:description"
      content="Sit and feast. Share what you long to build."
    />
    <meta
      property="og:image"
      content="https://lifeabundantly.github.io/ci.cherev/Table_Well.jpeg"
    />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="The Table ‚Ä¢ AKDmediaX" />
    <meta
      name="twitter:description"
      content="A creative fellowship where tech bows to Presence."
    />
    <meta
      name="twitter:image"
      content="https://lifeabundantly.github.io/ci.cherev/Table_Well.jpeg"
    />

    <!-- Main styles -->
    <link rel="stylesheet" href="style.css" />

    <!-- PWA manifest & theme color (we'll tune later) -->
    <link rel="manifest" href="ci-manifest.json" />
    <meta name="theme-color" content="#0fdfd1" />

    <!-- Inline gate styling so it ALWAYS shows -->
    <style>
      /* Full-screen CI gate overlay */
      #ci-gate {
        position: fixed;
        inset: 0;
        z-index: 999999;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #000;
        opacity: 1;
        visibility: visible;
        transition: opacity 0.6s ease-out, visibility 0.6s ease-out;
      }

      #ci-gate.ci-gate-closed {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }

      #ci-gate-video {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .ci-gate-content {
        position: relative;
        z-index: 1;
        text-align: center;
        color: #fff;
        padding: 2rem;
        max-width: 90%;
        background: rgba(0, 0, 0, 0.4);
        border-radius: 12px;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
      }

      .ci-gate-title {
        font-size: clamp(2rem, 7vw, 3.5rem);
        font-weight: 700;
        margin-bottom: 1rem;
        color: #0fdfd1;
        text-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
      }

      .ci-gate-text {
        font-size: clamp(1.05rem, 3.5vw, 1.4rem);
        margin-bottom: 2rem;
        line-height: 1.5;
        opacity: 0.95;
      }

      .ci-gate-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
        max-width: 320px;
        margin: 0 auto;
      }

      .ci-gate-btn {
        padding: 0.8rem 1.6rem;
        border-radius: 999px;
        border: none;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.15s, box-shadow 0.15s;
      }

      .ci-gate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.35);
      }

      .ci-gate-btn-primary {
        background: rgba(15, 223, 209, 0.95);
        color: #000;
      }

      .ci-gate-btn-secondary {
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.4);
      }
    </style>

    <!-- DO NOT try to change hostname here; that‚Äôs what was breaking things -->
  </head>

  <body>
    <!-- SINGLE GATE OVERLAY: always rendered first -->
    <div id="ci-gate">
      <video
        id="ci-gate-video"
        autoplay
        muted
        loop
        playsinline
        poster="Table_Well.jpeg"
      >
        <!-- This file already exists in /assets/ -->
        <source src="assets/intro-loop.mp4" type="video/mp4" />
      </video>

      <div class="ci-gate-content">
        <h1 class="ci-gate-title">Welcome to the Table</h1>
        <p class="ci-gate-text">
          This is your first encounter with the Table.<br />
          The House would like to interview you and begin shaping your
          inheritance story.
        </p>
        <div class="ci-gate-buttons">
          <button id="ci-gate-yes" class="ci-gate-btn ci-gate-btn-primary">
            Have a seat
          </button>
          <button id="ci-gate-no" class="ci-gate-btn ci-gate-btn-secondary">
            Not right now
          </button>
        </div>
      </div>
    </div>

    <!-- BACKGROUND image and existing Table layout (from your current page) -->
    <div class="background" aria-hidden="true"></div>

    <main class="page-shell" aria-label="The Table">
      <header class="hero">
        <h1 class="title">Your Inheritance is Served</h1>
        <h2 class="subtitle">Sit and Feast</h2>
      </header>

      <section
        class="table-input"
        aria-label="Table conversation input"
      >
        <form class="chat-form" autocomplete="off">
          <div class="chat-shell">
            <button
              type="button"
              class="icon-button attach"
              aria-label="Attach a scroll, file, or vision"
            >
              üìú
            </button>

            <input
              id="table-message"
              type="text"
              class="chat-input"
              placeholder="Taste and see‚Ä¶"
              aria-label="Share what you long to build"
            />

            <button
              type="button"
              class="icon-button breath"
              aria-label="Speak to the Table (voice input coming soon)"
            >
              <span class="breath-wave" aria-hidden="true">„Ä∞</span>
            </button>

            <button
              type="submit"
              class="icon-button send"
              aria-label="Send to the Table"
            >
              ‚û§
            </button>
          </div>
        </form>
      </section>

      <footer class="footer" aria-label="AKDmediaX identity">
        <div class="footer-text">
          <div class="brand">AKDmediaX</div>

          <div class="line">
            A Creative Fellowship Where Tech Bows to Presence
          </div>

          <div class="line">Redeeming Abba‚Äôs Kingdom Design</div>

          <div class="quote">
            ‚ÄúEmbrace the truth and hold it close.<br />
            Don‚Äôt let go of wisdom, instruction, and life-giving
            understanding.‚Äù ‚Äî TPT
          </div>

          <div class="rights">
            ¬© 2025 AKDmediaX ‚Äî All Rights Reserved.
          </div>
        </div>
      </footer>
    </main>

    <!-- Conversation panel (same behavior as before) -->
    <aside
      id="conversation-panel"
      class="conversation-panel"
      aria-label="Table conversation stream"
    >
      <div class="conversation-header">
        <span>The Table</span>
        <button
          type="button"
          class="panel-close"
          aria-label="Close conversation panel"
        >
          ‚úï
        </button>
      </div>
      <div class="conversation-body">
        <p class="conversation-placeholder">
          When the House is ready, this space will hold the living
          conversation ‚Äî responses, modes, and guidance flowing from the
          Table.
        </p>
      </div>
    </aside>

    <!-- Synthetic history / PWA helper (your existing file) -->
    <script src="ci-history.js"></script>

    <!-- SERVICE WORKER REGISTRATION (simple; we‚Äôll refine scope later) -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("./sw.js")
            .catch(function (err) {
              console.error("SW registration failed:", err);
            });
        });
      }
    </script>

    <!-- CI GATE CONTROLLER: hides gate & fires engagement event -->
    <script>
      (function () {
        const gate = document.getElementById("ci-gate");
        const yes = document.getElementById("ci-gate-yes");
        const no = document.getElementById("ci-gate-no");
        if (!gate || !yes || !no) return;

        const STORAGE_KEY = "ci.cherev.gate.seen";

        // If this device has already passed the gate, remove it immediately.
        try {
          if (localStorage.getItem(STORAGE_KEY) === "true") {
            gate.classList.add("ci-gate-closed");
            return;
          }
        } catch (e) {
          // if storage not available, we just show the gate every time
        }

        function dismiss(choice) {
          gate.classList.add("ci-gate-closed");

          try {
            localStorage.setItem(STORAGE_KEY, "true");
          } catch (e) {}

          // Tell ci-history.js that a real engagement happened
          try {
            window.dispatchEvent(
              new CustomEvent("ciengagement", { detail: { choice } })
            );
          } catch (e) {
            console.warn("ciengagement event error:", e);
          }
        }

        yes.addEventListener("click", function () {
          dismiss("yes");
        });

        no.addEventListener("click", function () {
          dismiss("no");
        });

        // Preload video for smoother first frame
        const vid = document.getElementById("ci-gate-video");
        if (vid && vid.load) vid.load();
      })();
    </script>

    <!-- Existing conversation-panel JS (same as your previous index) -->
    <script>
      (function () {
        const form = document.querySelector(".chat-form");
        const input = document.getElementById("table-message");
        const panel = document.getElementById("conversation-panel");
        const closeBtn = document.querySelector(".panel-close");
        const body = document.querySelector(".conversation-body");
        if (!form || !input || !panel || !closeBtn || !body) return;

        function openPanel() {
          panel.classList.add("open");
        }
        function closePanel() {
          panel.classList.remove("open");
        }

        closeBtn.addEventListener("click", closePanel);

        form.addEventListener("submit", function (e) {
          e.preventDefault();
          const value = (input.value || "").trim();
          if (!value) return;

          openPanel();

          const bubbleUser = document.createElement("div");
          bubbleUser.className = "bubble bubble-user";
          bubbleUser.textContent = value;
          body.appendChild(bubbleUser);

          const bubbleHouse = document.createElement("div");
          bubbleHouse.className = "bubble bubble-house";
          bubbleHouse.textContent =
            "The Table has received your vision. In the mirror, this space will soon respond, guide, and help you build.";
          body.appendChild(bubbleHouse);

          input.value = "";
          body.scrollTop = body.scrollHeight;
        });
      })();
    </script>

    <!-- PWA install prompt helper (can stay as-is) -->
    <script>
      (function () {
        let deferredPrompt = null;
        let installButton = null;

        window.addEventListener("beforeinstallprompt", function (e) {
          e.preventDefault();
          deferredPrompt = e;

          if (installButton) return;

          installButton = document.createElement("button");
          installButton.textContent = "Install CI.CHEREV";
          installButton.setAttribute(
            "aria-label",
            "Install the CI.CHEREV mirror app"
          );
          Object.assign(installButton.style, {
            position: "fixed",
            right: "1rem",
            bottom: "1rem",
            zIndex: "9999",
            padding: "0.6rem 1rem",
            borderRadius: "999px",
            border: "none",
            fontSize: "0.9rem",
            fontFamily: "inherit",
            cursor: "pointer",
            background: "rgba(15, 223, 209, 0.95)",
            color: "#000",
            boxShadow: "0 4px 16px rgba(0, 0, 0, 0.25)",
          });

          document.body.appendChild(installButton);

          installButton.addEventListener("click", async function () {
            if (!deferredPrompt) return;
            try {
              deferredPrompt.prompt();
              await deferredPrompt.userChoice;
            } catch (err) {
              console.error("Install prompt error:", err);
            }
            deferredPrompt = null;
            if (installButton && installButton.parentNode) {
              installButton.parentNode.removeChild(installButton);
            }
            installButton = null;
          });
        });

        window.addEventListener("appinstalled", function () {
          if (installButton && installButton.parentNode) {
            installButton.parentNode.removeChild(installButton);
          }
          installButton = null;
        });
      })();
    </script>
  </body>
</html>
